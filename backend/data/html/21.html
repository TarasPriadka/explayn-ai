<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>17. SQL Injection - Computer Security</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>SQL Injection | Computer Security</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="SQL Injection" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Online textbook for CS 161: Computer Security at UC Berkeley." /> <meta property="og:description" content="Online textbook for CS 161: Computer Security at UC Berkeley." /> <link rel="canonical" href="/web/sqli.html" /> <meta property="og:url" content="/web/sqli.html" /> <meta property="og:site_name" content="Computer Security" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="SQL Injection" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Online textbook for CS 161: Computer Security at UC Berkeley.","headline":"SQL Injection","url":"/web/sqli.html"}</script> <!-- End Jekyll SEO tag --> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" ></script> <script> let toggleDark = () => { let setDark = jtd.getTheme() !== 'dark'; jtd.setTheme(setDark ? 'dark' : 'default'); localStorage.setItem('darkMode', String(setDark)); }; window.addEventListener('DOMContentLoaded', () => { /* Add event to dark mode button. */ let a = document.getElementsByClassName('site-button')[2]; a.addEventListener('click', (e) => { e.preventDefault(); toggleDark(); }); /* Read local storage state. */ if (localStorage.getItem('darkMode') === 'true') { toggleDark(); } }); </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Computer Security </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Security Principles category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/principles/" class="nav-list-link">Security Principles</a><ul class="nav-list "><li class="nav-list-item "><a href="/principles/principles.html" class="nav-list-link">1. Security Principles</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Memory Safety category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/memory-safety/" class="nav-list-link">Memory Safety</a><ul class="nav-list "><li class="nav-list-item "><a href="/memory-safety/x86.html" class="nav-list-link">2. x86 Assembly and Call Stack</a></li><li class="nav-list-item "><a href="/memory-safety/vulnerabilities.html" class="nav-list-link">3. Memory Safety Vulnerabilities</a></li><li class="nav-list-item "><a href="/memory-safety/mitigations.html" class="nav-list-link">4. Mitigating Memory-Safety Vulnerabilities</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Cryptography category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/crypto/" class="nav-list-link">Cryptography</a><ul class="nav-list "><li class="nav-list-item "><a href="/crypto/intro.html" class="nav-list-link">5. Introduction to Cryptography</a></li><li class="nav-list-item "><a href="/crypto/symmetric.html" class="nav-list-link">6. Symmetric-Key Cryptography</a></li><li class="nav-list-item "><a href="/crypto/hashes.html" class="nav-list-link">7. Cryptographic Hashes</a></li><li class="nav-list-item "><a href="/crypto/macs.html" class="nav-list-link">8. Message Authentication Codes (MACs)</a></li><li class="nav-list-item "><a href="/crypto/prng.html" class="nav-list-link">9. Pseudorandom Number Generators</a></li><li class="nav-list-item "><a href="/crypto/key-exchange.html" class="nav-list-link">10. Diffie-Hellman Key Exchange</a></li><li class="nav-list-item "><a href="/crypto/public-key.html" class="nav-list-link">11. Public-Key Encryption</a></li><li class="nav-list-item "><a href="/crypto/signatures.html" class="nav-list-link">12. Digital Signatures</a></li><li class="nav-list-item "><a href="/crypto/certificates.html" class="nav-list-link">13. Certificates</a></li><li class="nav-list-item "><a href="/crypto/passwords.html" class="nav-list-link">14. Passwords</a></li><li class="nav-list-item "><a href="/crypto/case-studies.html" class="nav-list-link">15. Case Studies</a></li><li class="nav-list-item "><a href="/crypto/bitcoin.html" class="nav-list-link">16. Bitcoin</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Web Security category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/web/" class="nav-list-link">Web Security</a><ul class="nav-list "><li class="nav-list-item active"><a href="/web/sqli.html" class="nav-list-link active">17. SQL Injection</a></li><li class="nav-list-item "><a href="/web/intro.html" class="nav-list-link">18. Introduction to the Web</a></li><li class="nav-list-item "><a href="/web/sop.html" class="nav-list-link">19. Same-Origin Policy</a></li><li class="nav-list-item "><a href="/web/cookies.html" class="nav-list-link">20. Cookies and Session Management</a></li><li class="nav-list-item "><a href="/web/csrf.html" class="nav-list-link">21. Cross-Site Request Forgery (CSRF)</a></li><li class="nav-list-item "><a href="/web/xss.html" class="nav-list-link">22. Cross-Site Scripting (XSS)</a></li><li class="nav-list-item "><a href="/web/ui-attacks.html" class="nav-list-link">23. UI Attacks</a></li><li class="nav-list-item "><a href="/web/captchas.html" class="nav-list-link">24. CAPTCHAs</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Network Security category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/network/" class="nav-list-link">Network Security</a><ul class="nav-list "><li class="nav-list-item "><a href="/network/intro.html" class="nav-list-link">25. Introduction to Networking</a></li><li class="nav-list-item "><a href="/network/arp.html" class="nav-list-link">26. ARP</a></li><li class="nav-list-item "><a href="/network/wpa.html" class="nav-list-link">27. WPA</a></li><li class="nav-list-item "><a href="/network/dhcp.html" class="nav-list-link">28. DHCP</a></li><li class="nav-list-item "><a href="/network/bgp.html" class="nav-list-link">29. BGP</a></li><li class="nav-list-item "><a href="/network/transport.html" class="nav-list-link">30. TCP and UDP</a></li><li class="nav-list-item "><a href="/network/tls.html" class="nav-list-link">31. TLS</a></li><li class="nav-list-item "><a href="/network/dns.html" class="nav-list-link">32. DNS</a></li><li class="nav-list-item "><a href="/network/dnssec.html" class="nav-list-link">33. DNSSEC</a></li><li class="nav-list-item "><a href="/network/dos.html" class="nav-list-link">34. Denial-of-Service (DoS)</a></li><li class="nav-list-item "><a href="/network/firewalls.html" class="nav-list-link">35. Firewalls</a></li><li class="nav-list-item "><a href="/network/intrusion-detection.html" class="nav-list-link">36. Intrusion Detection</a></li><li class="nav-list-item "><a href="/network/abusing-intrusion-detection.html" class="nav-list-link">37. Abusing Intrusion Detection</a></li><li class="nav-list-item "><a href="/network/malware.html" class="nav-list-link">38. Malware</a></li><li class="nav-list-item "><a href="/network/tor.html" class="nav-list-link">39. Anonymity and Tor</a></li></ul></li><li class="nav-list-item"><a href="/glossary.html" class="nav-list-link">Glossary</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Computer Security" aria-label="Search Computer Security" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://cs161.org" class="site-button" > CS 161 </a> </li> <li class="aux-nav-list-item"> <a href="#" class="site-button" > Dark Mode </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/web/">Web Security</a></li> <li class="breadcrumb-nav-list-item"><span>17. SQL Injection</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="17-sql-injection"> <a href="#17-sql-injection" class="anchor-heading" aria-labelledby="17-sql-injection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17. SQL Injection </h1> <h2 id="171-code-injection"> <a href="#171-code-injection" class="anchor-heading" aria-labelledby="171-code-injection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17.1. Code Injection </h2> <p>SQL injection is a special case of a more broad category of attacks called code injections.</p> <p>As an example, consider a calculator website that accepts user input and calls <code class="language-plaintext highlighter-rouge">eval</code> in Python in the server backend to perform the calculation. For example, if a user types <code style="color: red">2+3</code> into the website, the server will run <code>eval('<span style="color: red">2+3</span>')</code> and return the result to the user.</p> <p>If the web server is not careful about checking user input, an attacker could provide a malicious input like</p> <p style="text-align: center"> <code style="color: red">2+3"); os.system("rm -rf /</code> </p> <p>When the web server plugs this into the <code class="language-plaintext highlighter-rouge">eval</code> function, the result looks like</p> <p style="text-align: center"> <code>eval("<span style="color: red">2+3"); os.system("rm *.*</span>")</code> </p> <p>If interpreted as code, this statement causes the web server to delete all its files!</p> <p>The general idea behind these attacks is that a web server uses user input as part of the code it runs. If the input is not properly checked, an attacker could create a special input that causes unintended code to run on the server.</p> <h2 id="172-sql-injection-example"> <a href="#172-sql-injection-example" class="anchor-heading" aria-labelledby="172-sql-injection-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17.2. SQL Injection Example </h2> <p>Many modern web servers use SQL databases to store information such as user logins or uploaded files. These servers often allow users to interact with the database through HTTP requests.</p> <p>For example, consider a website that stores a SQL table of course evaluations named <code class="language-plaintext highlighter-rouge">evals</code>:</p> <div class="table-wrapper"><table> <thead> <tr> <th><code class="language-plaintext highlighter-rouge">id</code></th> <th><code class="language-plaintext highlighter-rouge">course</code></th> <th><code class="language-plaintext highlighter-rouge">rating</code></th> </tr> </thead> <tbody> <tr> <td>1</td> <td>cs61a</td> <td>4.5</td> </tr> <tr> <td>2</td> <td>cs61b</td> <td>4.4</td> </tr> <tr> <td>3</td> <td>cs161</td> <td>5.0</td> </tr> </tbody> </table></div> <p>A user can make an HTTP GET request for a course rating through a URL:</p> <p style="text-align: center"> <code> http://www.berkeley.edu/evals?course=<span style="color: red">cs61a</span> </code> </p> <p>To process this request, the server performs a SQL query to look up the rating corresponding to the course the user requested:</p> <p style="text-align: center"> <code> SELECT rating FROM evals WHERE course = '<span style="color: red">cs61a</span>' </code> </p> <p>Just like the code injection example, if the server does not properly check user input, an attacker could create a special input that allows arbitrary SQL code to be run. Consider the following malicious input:</p> <p style="text-align: center"> <code style="color: red"> garbage'; SELECT password FROM passwords WHERE username = 'admin </code> </p> <p>When the web server plugs this into the SQL query, the resulting query looks like</p> <p style="text-align: center"> <code> SELECT rating FROM evals WHERE course = '<span style="color: red">garbage'; SELECT * FROM passwords WHERE username = 'admin</span>' </code> </p> <p>If interpreted as code, this causes the query to return the password for the <code class="language-plaintext highlighter-rouge">admin</code> user!</p> <h2 id="173-sql-injection-strategies"> <a href="#173-sql-injection-strategies" class="anchor-heading" aria-labelledby="173-sql-injection-strategies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17.3. SQL Injection Strategies </h2> <p>Writing a malicious input that creates a syntactically valid SQL query can be tricky. Let’s break down each part of the malicious input from the previous example:</p> <ul> <li><code class="language-plaintext highlighter-rouge">garbage</code> is a garbage input to the intended query so that it doesn’t return anything.</li> <li><code class="language-plaintext highlighter-rouge">'</code> closes the opening quote from the intended query. Without this closing quote, the rest of our query would be treated as a string, not SQL code.</li> <li><code class="language-plaintext highlighter-rouge">;</code> ends the intended SQL query and lets us start a new SQL query.</li> <li><code class="language-plaintext highlighter-rouge">SELECT password FROM passwords WHERE username = "admin</code> is the malicious SQL query we want to execute. Note that we didn’t add a closing quote to <code class="language-plaintext highlighter-rouge">"admin</code>, because the intended SQL query will automatically add a closing quote at the end of our input.</li> </ul> <p>Consider another vulnerable SQL query. This time, we have a <code class="language-plaintext highlighter-rouge">users</code> table that contains the <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> of every user.</p> <p>When the web server receives a login request, it creates a SQL query by plugging in the username and password from the request. For example, if you make a login request with username <code class="language-plaintext highlighter-rouge">alice</code> and password <code class="language-plaintext highlighter-rouge">password123</code>, the resulting SQL query would be</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice</span>' AND password = '<span style="color: red">password123</span>' </code> </p> <p>If the query returns more than 0 rows, the server registers a successful login.</p> <p>Suppose we want to login to the server, but we don’t have an account, and we don’t know anyone’s username. How might we achieve this using SQL injection?</p> <p>First, in the username field, we should add a dummy username and a quote to end the opening quote from the original query:</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice'</span>' AND password = '<span style="color: red">password123</span>' </code> </p> <p>Next, we need to add some SQL syntax so that this query returns more than 0 rows (since we don’t know if <code class="language-plaintext highlighter-rouge">alice</code> is a valid username). One trick for forcing a SQL query to always return something is to add some logic that always evaluates to true, such as <code class="language-plaintext highlighter-rouge">OR 1=1</code>:</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice' OR 1=1</span>' AND password = '<span style="color: red">_____</span>' </code> </p> <p>Next, we have to add some SQL so that the rest of the query doesn’t throw a syntax error. One way of doing this is to add a semicolon (ending the previous query) and write a dummy query that matches the remaining SQL:</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice' OR 1=1; SELECT username FROM users WHERE username = 'alice</span>' AND password = '<span style="color: red">_____</span>' </code> </p> <p>The second query might not return anything, but the first query will return a nonzero number of entries, which lets us perform a login. The last step is to add some garbage as the password:</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice' OR 1=1; SELECT username FROM users WHERE username = 'alice</span>' AND password = '<span style="color: red">garbage</span>' </code> </p> <p>Thus, our malicious username and password should be</p> <p style="text-align: center"> <span style="display: inline-block; text-align: left"> username = <code style="color: red"> alice' OR 1=1; SELECT username FROM users WHERE username = 'alice </code> <br /> password = <code style="color: red">garbage</code> </span> </p> <p>Another trick to make SQL injection easier is the <code class="language-plaintext highlighter-rouge">--</code> syntax, which starts a comment in SQL. This tells SQL to ignore the rest of the query as a comment.</p> <p>In our previous example, we can instead start a comment to ignore parts of the query we don’t want to execute:</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice' OR 1=1--</span><span style="opacity: 0.5">' AND password = '<span style="color: red">garbage</span>'</span> </code> </p> <p>Thus, another malicious username and password is</p> <p style="text-align: center"> <span style="display: inline-block; text-align: left"> username = <code style="color: red">alice' OR 1=1--</code> <br /> password = <code style="color: red">garbage</code> </span> </p> <p><em>Further reading:</em> <a href="http://www.unixwiz.net/techtips/sql-injection.html">SQL Injection Attacks by Example</a></p> <h2 id="174-defense-escape-inputs"> <a href="#174-defense-escape-inputs" class="anchor-heading" aria-labelledby="174-defense-escape-inputs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17.4. Defense: Escape Inputs </h2> <p>One way of defending against SQL injection is to escape any potential input that could be used in an attack. Escaping a character means that you tell SQL to treat this character as part of the string, not actual SQL syntax.</p> <p>For example, the quote <code class="language-plaintext highlighter-rouge">"</code> is used to denote the end of a string in SQL. However, the escaped quote <code class="language-plaintext highlighter-rouge">\"</code> is treated as a literal quote character in SQL, and it does not cause the current string to end.</p> <p>By properly replacing characters with their escaped version, malicious inputs such as the ones we’ve been creating will be treated as strings, and the SQL parser won’t try to run them as actual SQL commands.</p> <p>For example, in the previous exploit, if the server replaces all instances of the quote <code class="language-plaintext highlighter-rouge">"</code> and the dash <code class="language-plaintext highlighter-rouge">-</code> with escaped versions, the SQL parser will see</p> <p style="text-align: center"> <code> SELECT username FROM users WHERE username = '<span style="color: red">alice\' OR 1=1\-\-</span>' AND password = '<span style="color: red">garbage</span>' </code> </p> <p>The escaped quote won’t cause the <code class="language-plaintext highlighter-rouge">username</code> string to end, and the escaped dashes won’t cause a comment to be created. The parser will try to look up someone with a username <code class="language-plaintext highlighter-rouge">alice" OR 1=1--</code> and find nothing.</p> <p>However, we have to be careful with escaping. If an attacker inputs a backslash followed by a quote <code class="language-plaintext highlighter-rouge">\"</code>, the escaper might “escape the escape” and give the input <code class="language-plaintext highlighter-rouge">\\"</code> to the SQL parser. The parser will treat the two backslashes <code class="language-plaintext highlighter-rouge">\\</code> as an escaped backslash, and the quote won’t be escaped!</p> <p>The key takeaway here is that building a good escaper can be tricky, and there are many edge cases to consider. There is almost no circumstance in which you should try to build an escaper yourself; secure SQL escapers exist in SQL libraries for almost every programming language. However, if you are running SQL statements with raw user input, escapers are often an ineffective solution, because you need to ensure that every call is properly escaped. A far more robust solution is to use parameterized SQL.</p> <h2 id="175-defense-parameterized-sqlprepared-statements"> <a href="#175-defense-parameterized-sqlprepared-statements" class="anchor-heading" aria-labelledby="175-defense-parameterized-sqlprepared-statements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17.5. Defense: Parameterized SQL/Prepared Statements </h2> <p>A better defense against SQL injection is to use parameterized SQL or prepared statements. This type of SQL compiles the query first, and then plugs in user input after the query has already been interpreted by the SQL parser. Because the user input is added after the query is compiled and interpreted, there is no way for any attacker input to be treated as SQL code. Parameterized SQL prevents all SQL injection attacks, so it is the best defense against SQL injection!</p> <p>In most SQL libraries, parameterized SQL and unsafe, non-paramaterized SQL are provided as two different API functions. You can ensure that you’ve eliminated <em>all</em> potential SQL vulnerabilities in your code by searching for every database query and replacing each API call with a call to the parameterized SQL API function.</p> <p>The biggest problem with parameterized SQL is compatibility. SQL is a (mostly) generic language, so SQL written for MySQL can run on Postgres or commercial databases. Parameterized SQL requires support from the underlying database (since the processing itself happens on the database side), and there is no common standard for expressing parameterized SQL. Most SQL libraries will handle the translation for you, but switching to prepared statements may make it harder to switch between databases.</p> <p>In practice, most modern SQL libraries support parameterized SQL and prepared statements. If the library you are using does not support parameterized SQL, it is probably best to switch to a different SQL library.</p> <p><em>Further reading:</em> <a href="https://owasp.org/www-community/attacks/SQL_Injection">OWASP Cheat Sheet on SQL Injection</a></p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
